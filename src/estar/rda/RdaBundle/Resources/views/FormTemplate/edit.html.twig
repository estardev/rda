{% extends '::base.html.twig' %}



{% block body -%}
    <h1>Modifica RDA #{{ entity.id }}</h1>

    <div class="bottoniera">

        <div class="bottoni">{{ form(back_form, {'attr': {'novalidate': 'novalidate'}}) }}</div>
        <div class="bottoni"> {{ form(print_form, {'attr': {'novalidate': 'novalidate'}}) }}</div>
        {% if (stato == 'bozza') or (stato == 'attesa_val_tec') or (stato == 'attesa_val_amm') or (stato == 'da_inviare_ESTAR') %}
            {% if entity.numeroprotocollo is null %}
                <div class="bottoni">
                    <button class="btn btn-danger" data-toggle="modal" data-target="#confirmModalElimina"><span
                                class="glyphicon glyphicon-remove" aria-hidden="true"></span> Elimina
                    </button>&nbsp;
                </div>            {% endif %}
        {% endif %}

        {% if (stato=='inviata_ESTAR' ) %}
            <div class="bottoni">
                <button class="btn btn-primary" data-toggle="modal" data-target="#confirmModalAnnulla"><span
                            class="glyphicon glyphicon-remove" aria-hidden="true"></span> Annullare Richiesta
                </button></div>
        {% endif %}

        {% if ((diritti.isVA) and (stato=='da_inviare_ESTAR')) or (is_granted('ROLE_ADMIN') and (stato=='da_inviare_ESTAR')) %}
            <div class="bottoni"> {{ form(soap_form, {'attr': {'novalidate': 'novalidate'}}) }}</div>
        {% endif %}

        {% if (diritti.isAI and stato=='bozza') or (stato=='bozza') or (diritti.isVT and stato=='attesa_val_tec') or (diritti.isVA and stato=='attesa_val_amm') %}
            <div class="bottoni">
                <button class="btn btn-primary" data-toggle="modal" data-target="#confirmModal"><span
                            class="glyphicon glyphicon-transfer" aria-hidden="true"></span> Cambia Stato
                </button>
            </div>
        {% endif %}
        {% if is_granted('ROLE_ADMIN') %}
            <div class="bottoni">
                <button class="btn btn-primary" data-toggle="modal" data-target="#confirmModalAdminStato"><span
                            class="glyphicon glyphicon-transfer" aria-hidden="true"></span> Forza Stato (admin)
                </button>
            </div>
        {% endif %}
        <div class="bottoni">
            <button class="btn btn-primary" data-toggle="modal" data-target="#confirmModalClonazione"><span
                        class="glyphicon glyphicon-transfer" aria-hidden="true"></span> Clona
            </button>
        </div>

    </div>

    {{ form(edit_form, {'attr': {'novalidate': 'novalidate'}}) }}


    <div class="modal fade" id="confirmModal"
         aria-hidden="true" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                        <span class="sr-only">Chiudi</span>
                    </button>

                    <h4 class="modal-title">Messaggio di Notifica per avanzamento di Stato</h4>
                </div>

                <div class="modal-body">
                    {% for valida_form in valida_forms %}
                        {{ form(valida_form) }}
                    {% endfor %}
                    <!--<textarea name="messaggio" style="width: 100%; height: 200px; border: 1px solid #c0c0c0;"></textarea>-->
                </div>
            </div>
        </div>
    </div>

    {# *** - RigFi-2018.05.29 form per forzatura passaggio di stato (saltando macchina a stati)  - ***#}
    {% if is_granted('ROLE_ADMIN') %}
        <div class="modal fade" id="confirmModalAdminStato"
             aria-hidden="true" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">

                        <button type="button" class="close" data-dismiss="modal">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                            <span class="sr-only">Chiudi</span>
                        </button>

                        <h4 class="modal-title">Modulo Forza stato (admin)</h4>
                        Se confermato la richiesta assumerà gli stati (estar e gestav) selezionati di seguito indipendentemente da quelli in cui si trova attualmente!<br>
                        Stato ESTAR attuale: {{ stato }}<br>
                        Stato GESTAV attuale: {% if gestav != null %}{{ gestav }}{% else %}nessuno{% endif %}
                    </div>
                    <div class="modal-body">
                            {{ form(imponiStato_form) }}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    {# *** - fine RigFi-2018.05.31 - *** #}

    <div class="modal fade" id="confirmModalClonazione"
         aria-hidden="true" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                        <span class="sr-only">Chiudi</span>
                    </button>

                    <h4 class="modal-title">Clonazione richiesta</h4>
                    La richiesta verrà clonata con tutti i campi, senza i documenti, senza alcuno stato in ABS e in stato di bozza su RDA.
                </div>

                <div class="modal-body">
                        {{ form(clona_form) }}
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmModalElimina"
         aria-hidden="true" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                        <span class="sr-only">Chiudi</span>
                    </button>

                    <h4 class="modal-title">Sicuro di voler eliminare?</h4>
                </div>

                <div class="modal-body">
                     {{ form(delete_form, {'attr': {'novalidate': 'novalidate'}}) }}
                    <!--<textarea name="messaggio" style="width: 100%; height: 200px; border: 1px solid #c0c0c0;"></textarea>-->
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmModalAnnulla"
         aria-hidden="true" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                        <span class="sr-only">Chiudi</span>
                    </button>

                    <h4 class="modal-title">Sicuro di voler annullare?</h4>
                </div>

                <div class="modal-body">
                    {{ form(annulla_form, {'attr': {'novalidate': 'novalidate'}}) }}
                </div>
            </div>
        </div>
    </div>

{% endblock %}

    {% block javascripts %}
        {{ parent() }}
        <script type="text/javascript">
            $(document).ready(function () {
                    $('form').submit(function () {
                            $('button[name="form[submit]"]').attr('disabled', true);
                        }
                    );
                    //$('#form_Azienda_agg :input').attr('disabled',true);
                    var selezionato = "";
                    selezionato = $('#form_azienda option:selected').val();
                    if (selezionato == 21) {
                        $('#form_Azienda_agg :input').removeAttr('disabled');
                    }
                    else {
                        $('#form_Azienda_agg :input').attr('disabled', true);
                        $('#form_Azienda_agg :input').attr('checked', false);
                    }
                }
            );
        </script>
    {% endblock %}
